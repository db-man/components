{"version":3,"file":"helpers.js","names":["message","constants","errMsg","loadDbsSchemaAsync","github","githubDb","path","files","getPath","dbsSchema","Promise","all","map","name","dbName","getDbTablesSchemaAsync","then","tables","validateDbsSchame","Object","keys","forEach","table","index","warning","columns","reloadDbsSchemaAsync","info","localStorage","getItem","LS_KEY_GITHUB_REPO_PATH","err","LS_KEY_GITHUB_OWNER","LS_KEY_GITHUB_REPO_NAME","setItem","LS_KEY_DBS_SCHEMA","JSON","stringify","setTimeout","window","location","reload"],"sources":["../../src/pages/helpers.ts"],"sourcesContent":["// @ts-nocheck\n\nimport { message } from 'antd';\nimport * as constants from '../constants';\nimport { errMsg } from '../utils';\n\nconst loadDbsSchemaAsync = async (github, githubDb, path) => {\n  // Get all db names in root dir, db name is sub dir name\n  const files = await github.getPath(path);\n\n  const dbsSchema = {\n    /**\n     * key must be:\n     * - Top Nav title name\n     * - Folder name in https://github.com/{user_name}/{repo_name}/tree/main/{path}\n     */\n    // dbName: [{ name: \"table_name\", columns: [] }]\n  };\n\n  // Loop get all table schema\n  await Promise.all(\n    files\n      .map(({ name }) => name)\n      .map((dbName) => githubDb.getDbTablesSchemaAsync(dbName).then((tables) => {\n        dbsSchema[dbName] = tables;\n      })),\n  );\n\n  return dbsSchema;\n};\n\nconst validateDbsSchame = (dbsSchema) => {\n  Object.keys(dbsSchema).forEach((dbName) => {\n    const tables = dbsSchema[dbName];\n    tables.forEach((table, index) => {\n      if (!table.name) {\n        message.warning(`Missing table name, dbName:${dbName}, index:${index}`, 10);\n      }\n      if (!table.columns) {\n        message.warning(`Missing table columns, tableName: ${table.name}, dbName:${dbName}`, 10);\n      }\n    });\n  });\n};\n\nconst reloadDbsSchemaAsync = async (github, githubDb) => {\n  message.info('Start loading DBs schema...');\n\n  const path = localStorage.getItem(constants.LS_KEY_GITHUB_REPO_PATH);\n  if (!path) {\n    errMsg('Repo path not found in localStorage!');\n    return;\n  }\n\n  let dbsSchema;\n  try {\n    dbsSchema = await loadDbsSchemaAsync(github, githubDb, path);\n  } catch (err) {\n    errMsg(`Failed to get DB schema! Maybe you need to create this file: https://github.com/${localStorage.getItem(constants.LS_KEY_GITHUB_OWNER)}/${localStorage.getItem(constants.LS_KEY_GITHUB_REPO_NAME)}/${path}`, err);\n    return;\n  }\n\n  validateDbsSchame(dbsSchema);\n\n  localStorage.setItem(constants.LS_KEY_DBS_SCHEMA, JSON.stringify(dbsSchema));\n\n  message.info('Finish loading DBs schema! Will reload window in 3s!');\n\n  setTimeout(() => {\n    window.location.reload();\n  }, 3000);\n};\n\nexport default reloadDbsSchemaAsync;\n"],"mappings":"AAAA;;AAEA,SAASA,OAAO,QAAQ,MAAM;AAC9B,OAAO,KAAKC,SAAS,MAAM,cAAc;AACzC,SAASC,MAAM,QAAQ,UAAU;AAEjC,MAAMC,kBAAkB,GAAG,MAAAA,CAAOC,MAAM,EAAEC,QAAQ,EAAEC,IAAI,KAAK;EAC3D;EACA,MAAMC,KAAK,GAAG,MAAMH,MAAM,CAACI,OAAO,CAACF,IAAI,CAAC;EAExC,MAAMG,SAAS,GAAG;IAChB;AACJ;AACA;AACA;AACA;IACI;EAAA,CACD;;EAED;EACA,MAAMC,OAAO,CAACC,GAAG,CACfJ,KAAK,CACFK,GAAG,CAAC,CAAC;IAAEC;EAAK,CAAC,KAAKA,IAAI,CAAC,CACvBD,GAAG,CAAEE,MAAM,IAAKT,QAAQ,CAACU,sBAAsB,CAACD,MAAM,CAAC,CAACE,IAAI,CAAEC,MAAM,IAAK;IACxER,SAAS,CAACK,MAAM,CAAC,GAAGG,MAAM;EAC5B,CAAC,CAAC,CACN,CAAC;EAED,OAAOR,SAAS;AAClB,CAAC;AAED,MAAMS,iBAAiB,GAAIT,SAAS,IAAK;EACvCU,MAAM,CAACC,IAAI,CAACX,SAAS,CAAC,CAACY,OAAO,CAAEP,MAAM,IAAK;IACzC,MAAMG,MAAM,GAAGR,SAAS,CAACK,MAAM,CAAC;IAChCG,MAAM,CAACI,OAAO,CAAC,CAACC,KAAK,EAAEC,KAAK,KAAK;MAC/B,IAAI,CAACD,KAAK,CAACT,IAAI,EAAE;QACfb,OAAO,CAACwB,OAAO,CAAE,8BAA6BV,MAAO,WAAUS,KAAM,EAAC,EAAE,EAAE,CAAC;MAC7E;MACA,IAAI,CAACD,KAAK,CAACG,OAAO,EAAE;QAClBzB,OAAO,CAACwB,OAAO,CAAE,qCAAoCF,KAAK,CAACT,IAAK,YAAWC,MAAO,EAAC,EAAE,EAAE,CAAC;MAC1F;IACF,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC;AAED,MAAMY,oBAAoB,GAAG,MAAAA,CAAOtB,MAAM,EAAEC,QAAQ,KAAK;EACvDL,OAAO,CAAC2B,IAAI,CAAC,6BAA6B,CAAC;EAE3C,MAAMrB,IAAI,GAAGsB,YAAY,CAACC,OAAO,CAAC5B,SAAS,CAAC6B,uBAAuB,CAAC;EACpE,IAAI,CAACxB,IAAI,EAAE;IACTJ,MAAM,CAAC,sCAAsC,CAAC;IAC9C;EACF;EAEA,IAAIO,SAAS;EACb,IAAI;IACFA,SAAS,GAAG,MAAMN,kBAAkB,CAACC,MAAM,EAAEC,QAAQ,EAAEC,IAAI,CAAC;EAC9D,CAAC,CAAC,OAAOyB,GAAG,EAAE;IACZ7B,MAAM,CAAE,mFAAkF0B,YAAY,CAACC,OAAO,CAAC5B,SAAS,CAAC+B,mBAAmB,CAAE,IAAGJ,YAAY,CAACC,OAAO,CAAC5B,SAAS,CAACgC,uBAAuB,CAAE,IAAG3B,IAAK,EAAC,EAAEyB,GAAG,CAAC;IACxN;EACF;EAEAb,iBAAiB,CAACT,SAAS,CAAC;EAE5BmB,YAAY,CAACM,OAAO,CAACjC,SAAS,CAACkC,iBAAiB,EAAEC,IAAI,CAACC,SAAS,CAAC5B,SAAS,CAAC,CAAC;EAE5ET,OAAO,CAAC2B,IAAI,CAAC,sDAAsD,CAAC;EAEpEW,UAAU,CAAC,MAAM;IACfC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC;EAC1B,CAAC,EAAE,IAAI,CAAC;AACV,CAAC;AAED,eAAef,oBAAoB"}