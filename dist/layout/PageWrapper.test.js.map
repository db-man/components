{"version":3,"file":"PageWrapper.test.js","names":["React","BrowserRouter","render","screen","act","setDbs","PageWrapper","describe","it","createElement","el","getByText","expect","toBeInTheDocument","dbsSchema","iam","name","columns","JSON","stringify","dbName","tableName","action","id","primary","Object","defineProperty","window","writable","value","jest","fn","mockImplementation","query","matches","media","onchange","addListener","removeListener","addEventListener","removeEventListener","dispatchEvent"],"sources":["../../src/layout/PageWrapper.test.tsx"],"sourcesContent":["import React from 'react';\nimport { BrowserRouter } from 'react-router-dom';\nimport { render, screen, act /* waitFor, */ } from '@testing-library/react';\n// import { GithubDb } from '@db-man/github';\n\n// import * as constants from '../constants';\nimport { setDbs } from '../dbs';\nimport PageWrapper from './PageWrapper';\n\n// jest.mock('@db-man/github');\n\ndescribe('PageWrapper', () => {\n  it('renders err when dbName is undefined', () => {\n    render(\n      <BrowserRouter>\n        <PageWrapper />\n      </BrowserRouter>\n    );\n    const el = screen.getByText(/dbName is undefined/i);\n    expect(el).toBeInTheDocument();\n  });\n\n  it('renders 404 when url not pass dbName', () => {\n    // jest.spyOn(Object.getPrototypeOf(window.localStorage), 'getItem');\n    // jest.spyOn(Object.getPrototypeOf(window.localStorage), 'setItem');\n    // Object.getPrototypeOf(window.localStorage).getItem = jest.fn((key) => {\n    //   if (key === constants.LS_KEY_DBS_SCHEMA) {\n    //     return '{\"iam\":[{\"name\":\"users\",\"columns\":[{\"id\":\"email\",\"primary\":true}]}]}';\n    //   }\n    //   return null;\n    // });\n    // Object.getPrototypeOf(window.localStorage).setItem = jest.fn();\n\n    render(\n      <BrowserRouter>\n        <PageWrapper />\n      </BrowserRouter>\n    );\n    // screen.debug();\n    const el = screen.getByText(/dbName is undefined/i);\n    expect(el).toBeInTheDocument();\n  });\n\n  it('renders when no columns for this table', () => {\n    const dbsSchema = { iam: [{ name: 'users', columns: [] }] };\n\n    // jest.spyOn(Object.getPrototypeOf(window.localStorage), 'getItem');\n    // jest.spyOn(Object.getPrototypeOf(window.localStorage), 'setItem');\n    // Object.getPrototypeOf(window.localStorage).getItem = jest.fn((key) => {\n    //   if (key === constants.LS_KEY_DBS_SCHEMA) {\n    //     return JSON.stringify(dbsSchema);\n    //   }\n    //   return null;\n    // });\n    // Object.getPrototypeOf(window.localStorage).setItem = jest.fn();\n\n    // Prepare db schema in localStorage\n    setDbs(JSON.stringify(dbsSchema));\n\n    render(\n      <BrowserRouter>\n        <PageWrapper dbName='iam' tableName='users' action='list' />\n      </BrowserRouter>\n    );\n    const el = screen.getByText(/No columns found for this table!/i);\n    expect(el).toBeInTheDocument();\n  });\n\n  it('renders', async () => {\n    const dbsSchema = {\n      iam: [\n        {\n          name: 'users',\n          columns: [{ id: 'userId', name: 'User ID', primary: true }],\n        },\n      ],\n    };\n\n    // jest.spyOn(Object.getPrototypeOf(window.localStorage), 'getItem');\n    // jest.spyOn(Object.getPrototypeOf(window.localStorage), 'setItem');\n    // Object.getPrototypeOf(window.localStorage).getItem = jest.fn((key) => {\n    //   if (key === constants.LS_KEY_DBS_SCHEMA) {\n    //     return JSON.stringify(dbsSchema);\n    //   }\n    //   return null;\n    // });\n    // Object.getPrototypeOf(window.localStorage).setItem = jest.fn();\n\n    Object.defineProperty(window, 'matchMedia', {\n      writable: true,\n      value: jest.fn().mockImplementation((query) => ({\n        matches: false,\n        media: query,\n        onchange: null,\n        addListener: jest.fn(), // deprecated\n        removeListener: jest.fn(), // deprecated\n        addEventListener: jest.fn(),\n        removeEventListener: jest.fn(),\n        dispatchEvent: jest.fn(),\n      })),\n    });\n\n    // githubDb.getTableRows.mockReset();\n    // githubDb.getTableRows.mockResolvedValue({ content: [{ userId: '123' }] });\n\n    // Prepare db schema in localStorage\n    setDbs(JSON.stringify(dbsSchema));\n\n    // eslint-disable-next-line testing-library/no-unnecessary-act\n    act(() => {\n      render(\n        <BrowserRouter>\n          <PageWrapper dbName='iam' tableName='users' action='list' />\n        </BrowserRouter>\n      );\n    });\n\n    // await screen.findByText('Loading iam/users ...');\n\n    // await waitFor(() => expect(document.title).toEqual('list users'));\n    // await waitFor(() => expect(githubDb.getTableRows).toHaveBeenCalledTimes(1));\n\n    // await screen.findByText('123');\n  });\n});\n"],"mappings":"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"}