{"version":3,"file":"ddRender.test.js","names":["Handlebars","getRender","getColumnRender","describe","test","view","id","expect","url","toMatchSnapshot","it","photos","colFunc","toBe","args","record","column","name","note","tables","columns","primary","ratesTableRows","tags","itemId","samples","tpl","compile","json","extra","rows","result","JSON","parse","toHaveLength","description"],"sources":["../../src/ddRender/ddRender.test.js"],"sourcesContent":["import Handlebars from 'handlebars/dist/handlebars';\nimport { getRender, getColumnRender } from './ddRender';\n\ndescribe('getColumnRender', () => {\n  test('should return proper value', () => {\n    const view = getColumnRender('type:listPage', {\n      id: 'url',\n      'type:listPage': 'ImageLink',\n    });\n    expect(\n      view('https://a.com/b.jpg', { url: 'https://a.com/b.jpg' }, 1),\n    ).toMatchSnapshot();\n  });\n\n  test('should return proper value2', () => {\n    const view = getColumnRender('type:listPage', {\n      id: 'yrl',\n      'type:listPage': [\n        'ImageLink',\n        '{\"url\":\"{{record.url}}\",\"imgSrc\":\"{{record.url}}\"}',\n      ],\n    });\n    expect(\n      view('https://a.com/large/b.jpg', { url: 'https://a.com/large/b.jpg' }),\n    ).toMatchSnapshot();\n  });\n\n  describe('given Link', () => {\n    it('should match snapshot', () => {\n      expect(\n        getColumnRender('type:listPage', {\n          'type:listPage': [\n            'Link',\n            '{\"href\":\"{{record.url}}\",\"text\":\"{{record.url}}\"}',\n          ],\n        })('https://foo.com', { url: 'https://foo.com' }),\n      ).toMatchSnapshot();\n    });\n  });\n\n  describe('given ImageLink', () => {\n    it('should match snapshot', () => {\n      expect(\n        getColumnRender('type:listPage', {\n          'type:listPage': [\n            'ImageLink',\n            '{\"url\":\"{{record.photos.[0]}}\",\"imgSrc\":\"{{record.photos.[0]}}\"}',\n          ],\n        })('https://foo.com/a.jpg', {\n          id: 'foo',\n          photos: ['https://foo.com/a.jpg'],\n        }),\n      ).toMatchSnapshot();\n    });\n    it('should match snapshot when photos is undefined', () => {\n      expect(\n        getColumnRender('type:listPage', {\n          'type:listPage': [\n            'ImageLink',\n            '{\"url\":\"{{record.photos.[0]}}\",\"imgSrc\":\"record.photos.[0]\"}',\n          ],\n        })('', { id: 'foo' }),\n      ).toMatchSnapshot();\n    });\n  });\n\n  describe('given hidden column in a list page', () => {\n    it('should return default render func', () => {\n      const colFunc = getColumnRender('type:listPage', {\n        'type:listPage': 'HIDE',\n      });\n      expect(colFunc('foo')).toBe('foo');\n    });\n  });\n});\n\ndescribe('getRender', () => {\n  describe('given simple arg', () => {\n    it('should render properly', () => {\n      const args = 'Link';\n      const record = { url: 'https://foo.com' };\n      expect(getRender(args)(record.url, record)).toMatchSnapshot();\n    });\n  });\n  describe('given tpl', () => {\n    it('should render properly', () => {\n      const args = [\n        'Link',\n        '{\"href\":\"{{record.url}}\",\"text\":\"{{record.url}}\"}',\n      ];\n      const record = { url: 'https://foo.com' };\n      expect(getRender(args)(record.url, record)).toMatchSnapshot();\n    });\n  });\n  describe('TextAreaFormFieldValue', () => {\n    it('should match snapshot', () => {\n      const args = [\n        'TextAreaFormFieldValue',\n        '{\"label\":\"{{extra.column.name}}\",\"rows\":2,\"value\":\"{{record.note}}\"}',\n      ];\n      const column = { id: 'note', name: 'Note' };\n      const record = { note: 'This is TODO' };\n      expect(\n        getRender(args, { column })(record.note, record),\n      ).toMatchSnapshot();\n    });\n  });\n});\n\ndescribe('handlebars helper getTableRecordByKey', () => {\n  it('should return proper value', () => {\n    const tables = [\n      { name: 'rates', columns: [{ id: 'url', primary: true }] },\n      { name: 'details', columns: [{ id: 'itemId', primary: true }] },\n    ];\n    const ratesTableRows = [\n      { url: 'https://foo.jpg', tags: ['foo', 'bar'] },\n      { url: 'https://bar.jpg', tags: ['foo2', 'bar2'] },\n    ];\n    const record = {\n      itemId: '123',\n      samples: ['https://foo.jpg', 'https://bar.jpg'],\n    };\n    const tpl = Handlebars.compile(`[\n{{#each record.samples}}\n{{#if @index}},{{/if}}\n{\n  \"url\":\"{{this}}\",\n  \"imgSrc\":\"{{this}}_th.jpg\",\n  \"description\":\"{{#with (\n    getTableRecordByKey\n    tables=../extra.tables\n    tableName=\"rates\"\n    primaryKeyVal=this\n    rows=../extra.rows\n  )}}{{join tags \", \"}}{{/with}}\"\n}\n{{/each}}\n]`);\n    const json = tpl({\n      record,\n      extra: {\n        tables,\n        rows: ratesTableRows,\n      },\n    });\n    const result = JSON.parse(json);\n    expect(result).toHaveLength(2);\n    expect(result[0].url).toBe('https://foo.jpg');\n    expect(result[0].description).toBe('foo, bar');\n  });\n});\n"],"mappings":"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"}