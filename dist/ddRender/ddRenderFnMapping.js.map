{"version":3,"file":"ddRenderFnMapping.js","names":["React","Handlebars","ImageLink","ImageLinks","Link","Links","Fragment","PhotoList","ErrorAlert","TextAreaFormFieldValue","getTablePrimaryKey","registerHelper","replaceHelper","find","replace","options","string","fn","arr","sep","join","hash","rows","primaryKey","tables","tableName","row","primaryKeyVal","genRenderFunc","Component","dComponent","val","record","index","args","tplExtra","console","error","createElement","tplStr","tpl","compile","json","extra","props","JSON","parse","err","ddRenderFnMapping"],"sources":["../../src/ddRender/ddRenderFnMapping.tsx"],"sourcesContent":["// @ts-nocheck\n\n/* eslint-disable max-len */\n\nimport React from 'react';\n/**\n * https://github.com/handlebars-lang/handlebars.js/issues/1174\n * ```\n * Compiled with problems:\n * ERROR in ./node_modules/handlebars/lib/index.js 15:11-24\n * Module not found: Error: Can't resolve 'fs' in '/.../node_modules/handlebars/lib'\n * ```\n */\n// import Handlebars from \"handlebars\";\nimport Handlebars from 'handlebars/dist/handlebars';\n\nimport {\n  ImageLink,\n  ImageLinks,\n  Link,\n  Links,\n  Fragment,\n} from '../components/Links';\nimport PhotoList from '../components/PhotoList';\nimport ErrorAlert from '../components/ErrorAlert';\nimport TextAreaFormFieldValue from '../components/TextAreaFormFieldValue';\nimport { getTablePrimaryKey } from '../utils';\n\n/**\n * tpl: {{#replace \"foo\" \"bar\"}}{{title}}{{/replace}}\n * input: {title:\"foo\"}\n * output: bar\n */\nHandlebars.registerHelper(\n  'replace',\n  function replaceHelper(find, replace, options) {\n    const string = options.fn(this);\n    return string.replace(find, replace);\n  },\n);\n\n/**\n * tpl: {{join record.tags \", \"}}\n * input: {\"tags\": [\"foo\", \"bar\"]}\n * output: \"foo, bar\"\n */\nHandlebars.registerHelper('join', (arr, sep) => {\n  if (!arr) return '';\n  return arr.join(sep);\n});\n\nHandlebars.registerHelper('getTableRecordByKey', (options) => {\n  if (!options.hash.rows) return null;\n  const primaryKey = getTablePrimaryKey(\n    options.hash.tables,\n    options.hash.tableName,\n  );\n  return options.hash.rows.find(\n    (row) => row[primaryKey] === options.hash.primaryKeyVal,\n  );\n});\n\n/**\n * Generate a render function based on the passing component,\n * so we can later call this render function by passing an Handlebars template to dynamic render component based on the passing record\n * @param {*} Component\n * @returns {()=><Component/>} render function\n */\nconst genRenderFunc = (Component) =>\n  function dComponent(val, record, index, args, tplExtra) {\n    if (!record || typeof record !== 'object') {\n      console.error('[genRenderFunc] record should be an object!', record); // eslint-disable-line no-console\n    }\n    if (!args || !args[1]) {\n      return <Component>{val}</Component>;\n    }\n\n    const tplStr = args[1];\n    const tpl = Handlebars.compile(tplStr);\n    const json = tpl({ record, extra: tplExtra });\n    try {\n      // {foo:'bar'} <= \"{\\\"foo\\\":\\\"bar\\\"}\"\n      // \"foo\" <= \"\\\"foo\\\"\"\n      const props = JSON.parse(json);\n      if (typeof props === 'string') {\n        return <Component>{props}</Component>;\n      }\n      return <Component {...props} />; // eslint-disable-line react/jsx-props-no-spreading\n    } catch (err) {\n      console.error('Failed to parse JSON for tpl, err:', err, json); // eslint-disable-line no-console\n      return (\n        <div>\n          val: {val}\n          <ErrorAlert json={json} error={err} tplStr={tplStr} record={record} />\n        </div>\n      );\n    }\n  };\n\n/**\n * Data Driving Render Function Mapping\n */\nconst ddRenderFnMapping = {\n  // renderFnName: (cellVal, rowVal, colIndex, ...renderFnStr) => null\n  // renderFnName: (cellVal, rowVal, colIndex, ...renderFnProps) => null\n\n  /**\n   * @param {number|string} val e.g. \"docs\"\n   * @param {Object} record e.g. `{\"org\":\"github\",\"repo\":\"docs\"}`\n   * @param {number} index e.g. 9, it's the 10th row\n   * @param {Object|undefined} args e.g `[\"Link\", \"{\\\"href\\\":\\\"https://github.com/{{record.org}}/{{record.repo}}\\\",\\\"text\\\":\\\"{{record.repo}}\\\"}\"]`\n   *                                args could be undefined when column is {\"type:listPage\": \"Link\"}\n   *  Usage:\n   * 1. \"type:getPage\": [\"Link\", \"{\\\"href\\\":\\\"https://github.com/{{record.org}}/{{record.repo}}\\\",\\\"text\\\":\\\"{{record.repo}}\\\"}\"],\n   * 2. \"type:listPage\": [\"Link\", \"{\\\"href\\\":\\\"https://github.com/{{record.org}}/{{record.repo}}\\\",\\\"text\\\":\\\"{{record.repo}}\\\"}\"]\n   * 3. \"type:listPage\": \"Link\"\n   */\n  Link: genRenderFunc(Link),\n  /**\n   * Usage:\n   * ```json\n   * {\"type:listPage\": [\"ImageLink\",\n   *   \"{\\\"url\\\":\\\"{{record.url}}\\\",\\\"imgSrc\\\":\\\"{{record.url}}_th.jpg\\\",\n   *     \\\"tags\\\":\\\"{{record.tags}}\\\"}\"\n   * ]}\n   * ```\n   * Issues:\n   *   When record.url=\"https://foo.com/get?foo=bar\".\n   *   By using `{{record.url}}` will generate \"https://foo.com/get?foo&#x3D;bar\".\n   *   To prevent this issue, `{{{record.url}}}` could be used. (https://handlebarsjs.com/guide/expressions.html#html-escaping)\n   */\n  ImageLink: genRenderFunc(ImageLink),\n  ImageLinks: genRenderFunc(ImageLinks),\n  /**\n   * Usage:\n   * ```json\n   * {\"type:listPage\": [\"Fragment\", \"{{join record.tags \\\", \\\"}}\"]}\n   * ```\n   */\n  Fragment: genRenderFunc(Fragment),\n  Links: genRenderFunc(Links),\n  /**\n   * Usage:\n   * ```json\n   * {\n   *   \"type:getPage\": [\n   *     \"PhotoList\",\n   *     \"[{{#each record.photoUrls}}{{#if @index}},{{/if}}{\\\"url\\\":\\\"{{this}}\\\",\\\"imgSrc\\\":\\\"{{this}}_th.jpg\\\",\\\"description\\\":\\\"{{#with (getTableRecordByKey tables=../extra.tables tableName=\\\"rates\\\" primaryKeyVal=this rows=../extra.rows)}}{{join tags \\\", \\\"}}{{/with}}\\\"}{{/each}}]\"\n   *   ]\n   * }\n   * ```\n   */\n  PhotoList: genRenderFunc(PhotoList),\n  TextAreaFormFieldValue: genRenderFunc(TextAreaFormFieldValue),\n};\n\nexport default ddRenderFnMapping;\n"],"mappings":"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"}