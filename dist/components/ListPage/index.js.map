{"version":3,"file":"index.js","names":["React","useContext","useEffect","useRef","useState","PropTypes","Link","Table","Input","Row","Col","Spin","Popover","Alert","message","RightSquareFilled","debounce","PageContext","getColumnRender","findDuplicates","getFilteredData","getSortedData","getInitialFilter","updateUrl","getColumnSortOrder","getInitialSorter","RefTableLinks","constants","defaultPage","defaultPageSize","debouncedUpdateUrl","filterCols","columns","filter","col","ListPage","props","tableName","primaryKey","dbName","githubDb","setFilter","sorter","setSorter","columnKey","order","loading","setLoading","errMsg","setErrMsg","rows","setRows","contentTableName","setContentTableName","page","setPage","url","URL","window","location","href","Number","searchParams","get","pageSize","setPageSize","controllerRef","AbortController","getData","current","abort","filteredSortedData","filteredData","undefined","handleKeyDown","e","key","prevPage","length","scrollTo","top","behavior","info","addEventListener","removeEventListener","handleFilterChange","event","prevFilter","newFilter","target","value","handleTableChange","pagination","filters","newSorter","content","getTableRows","signal","error","console","alertDuplicatedRowKey","duplicatedRowKeys","map","item","createElement","style","color","join","alertTableDataInvalid","invalidRows","forEach","row","idx","push","rowIdx","rowData","JSON","stringify","alertValidations","className","getTableColumns","cols","column","TYPE_LIST_PAGE","antdCol","id","title","name","dataIndex","sortOrder","tableProps","renderFn","render","referenceTable","lastRender","val","hasVal","type","STRING_ARRAY","args","trigger","to","pathname","search","renderTable","tip","size","showSorterTooltip","rowKey","dataSource","showQuickJumper","showTotal","total","onChange","gutter","f","span","propTypes","string","isRequired"],"sources":["../../../src/components/ListPage/index.tsx"],"sourcesContent":["import React, {\n  ChangeEvent,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport PropTypes from 'prop-types';\nimport { Link } from 'react-router-dom';\nimport { Table, Input, Row, Col, Spin, Popover, Alert, message } from 'antd';\nimport type { TableProps, ColumnType as AntdColumnType } from 'antd/es/table';\nimport { RightSquareFilled } from '@ant-design/icons';\n// @ts-ignore TODO: fix types for lodash\nimport debounce from 'lodash.debounce';\n\nimport PageContext, { PageContextType } from '../../contexts/page';\nimport { getColumnRender } from '../../ddRender/ddRender';\nimport {\n  findDuplicates,\n  getFilteredData,\n  getSortedData,\n  getInitialFilter,\n  updateUrl,\n  getColumnSortOrder,\n  getInitialSorter,\n} from './helpers';\nimport RefTableLinks from '../RefTableLinks';\nimport * as constants from '../../constants';\nimport DbColumn from '../../types/DbColumn';\nimport { RowType } from '../../types/Data';\n\ninterface ListPageProps {\n  tableName: string;\n}\n\nconst defaultPage = 1;\nconst defaultPageSize = 10;\nconst debouncedUpdateUrl = debounce(updateUrl, 500);\n\nconst filterCols = (columns: DbColumn[]) => {\n  return columns.filter((col) => col.filter);\n};\n\nconst ListPage = (props: ListPageProps) => {\n  const { columns, tableName, primaryKey, dbName, githubDb } =\n    useContext<PageContextType>(PageContext);\n\n  const [filter, setFilter] = useState<Record<string, string>>({}); // getInitialFilter(filterCols()), cannot get context in constructor\n  const [sorter, setSorter] = useState({\n    columnKey: '', // e.g. \"url\"\n    order: '', //  \"ascend\" or \"descend\" or undefined\n  });\n  const [loading, setLoading] = useState('');\n  const [errMsg, setErrMsg] = useState('');\n  const [rows, setRows] = useState<RowType[] | null>(null);\n  const [contentTableName, setContentTableName] = useState(''); // the current table name of data this.state.rows\n  const [page, setPage] = useState(() => {\n    const url = new URL(window.location.href);\n    return Number(url.searchParams.get('page')) || defaultPage;\n  });\n  const [pageSize, setPageSize] = useState(() => {\n    const url = new URL(window.location.href);\n    return Number(url.searchParams.get('pageSize')) || defaultPageSize;\n  });\n\n  const controllerRef = useRef(new AbortController());\n\n  useEffect(() => {\n    getData(tableName);\n    setFilter(getInitialFilter(filterCols(columns)));\n    setSorter(getInitialSorter());\n\n    return () => {\n      // When your component unmounts\n\n      // Cancel all HTTP requests in this page\n      controllerRef.current.abort();\n    };\n  }, []);\n\n  const filteredSortedData = () => {\n    const filteredData = getFilteredData(\n      filterCols(columns),\n      filter,\n      rows || []\n    );\n    if (sorter.columnKey && sorter.order !== undefined) {\n      return getSortedData(filteredData, sorter);\n    }\n    return filteredData;\n  };\n\n  const handleKeyDown = (e: KeyboardEvent) => {\n    if (e.key === 'ArrowRight') {\n      setPage((prevPage) => {\n        if (prevPage < filteredSortedData().length / pageSize) {\n          window.scrollTo({ top: 0, behavior: 'smooth' });\n          debouncedUpdateUrl({ page: prevPage + 1 });\n          return prevPage + 1;\n        } else {\n          message.info('This is the last page!');\n          return prevPage;\n        }\n      });\n    } else if (e.key === 'ArrowLeft') {\n      setPage((prevPage) => {\n        if (prevPage > 1) {\n          window.scrollTo({ top: 0, behavior: 'smooth' });\n          debouncedUpdateUrl({ page: prevPage - 1 });\n          return prevPage - 1;\n        } else {\n          message.info('This is the first page!');\n          return prevPage;\n        }\n      });\n    }\n  };\n\n  useEffect(() => {\n    window.addEventListener('keydown', handleKeyDown, false);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown, false);\n    };\n  }, [rows]);\n\n  useEffect(() => {\n    getData(props.tableName);\n  }, [props.tableName]);\n\n  const handleFilterChange =\n    (key: string) => (event: ChangeEvent<HTMLInputElement>) => {\n      setFilter((prevFilter) => {\n        const newFilter = {\n          ...prevFilter,\n          [key]: event.target.value,\n        };\n        debouncedUpdateUrl({ filter: newFilter });\n        return newFilter;\n      });\n    };\n\n  const handleTableChange: TableProps<RowType>['onChange'] = (\n    pagination,\n    filters,\n    newSorter /* , extra */\n  ) => {\n    setPage(pagination.current || defaultPage);\n    setPageSize(pagination.pageSize || defaultPageSize);\n    setSorter({\n      // @ts-ignore TODO: fix types for antd\n      columnKey: newSorter.columnKey,\n      // @ts-ignore TODO: fix types for antd\n      order: newSorter.order, // order could be undefined\n    });\n    debouncedUpdateUrl({\n      page: pagination.current,\n      pageSize: pagination.pageSize,\n      sorter: {\n        // @ts-ignore TODO: fix types for antd\n        columnKey: newSorter.columnKey,\n        // @ts-ignore TODO: fix types for antd\n        order: newSorter.order, // order could be undefined\n      },\n    });\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n  };\n\n  const getData = async (tableName: string) => {\n    setLoading(`Loading ${dbName}/${tableName} ...`);\n    try {\n      const { content } = await githubDb!.getTableRows(\n        dbName,\n        tableName,\n        controllerRef.current.signal\n      );\n      setRows(content);\n      setContentTableName(tableName);\n    } catch (error) {\n      console.error('Failed to get JSON file in List component, error:', error); // eslint-disable-line no-console\n      setErrMsg(`Failed to get data: ${(error as Error).message}`);\n    }\n    setLoading('');\n  };\n\n  const alertDuplicatedRowKey = () => {\n    if (!rows) return null;\n    const duplicatedRowKeys = findDuplicates(\n      rows.map((item) => item[primaryKey])\n    );\n    if (duplicatedRowKeys.length === 0) return null;\n    return (\n      <div style={{ color: 'red' }}>\n        Duplicated row keys(\n        {duplicatedRowKeys.length}\n        ): {duplicatedRowKeys.join(', ')}\n      </div>\n    );\n  };\n\n  const alertTableDataInvalid = () => {\n    const invalidRows: RowType[] = [];\n    if (!rows) return null;\n    rows.forEach((row, idx) => {\n      if (row[primaryKey] === undefined || row[primaryKey] === null) {\n        invalidRows.push({\n          rowIdx: idx,\n          rowData: row,\n        });\n      }\n    });\n    if (invalidRows.length === 0) return null;\n    return (\n      <div style={{ color: 'red' }}>\n        Invalid rows(\n        {invalidRows.length}\n        ):{' '}\n        {invalidRows.map((row) => (\n          <div>\n            {`idx:${row.rowIdx}`} {JSON.stringify(row.rowData)}\n          </div>\n        ))}\n      </div>\n    );\n  };\n\n  const alertValidations = () => (\n    <div className='dm-alert-validations'>\n      {alertDuplicatedRowKey()}\n      {alertTableDataInvalid()}\n    </div>\n  );\n\n  const getTableColumns = () => {\n    const cols = columns\n      .filter((column) => column[constants.TYPE_LIST_PAGE] !== 'HIDE')\n      .map((column) => {\n        // Table component of antd\n        const antdCol: AntdColumnType<RowType> = {\n          key: column.id,\n          title: column.name,\n          dataIndex: column.id,\n          // Order of sorted values: 'ascend', 'descend', false\n          sortOrder: getColumnSortOrder(column.id, sorter),\n          sorter: true,\n          ...column.tableProps,\n        };\n\n        const renderFn = getColumnRender(constants.TYPE_LIST_PAGE, column);\n        if (renderFn) {\n          antdCol.render = renderFn;\n        }\n\n        if (column.referenceTable) {\n          const lastRender = antdCol.render || ((val: any) => val);\n          const hasVal = (val: string | string[]) => {\n            if (column.type === constants.STRING_ARRAY) {\n              if (!val || val.length === 0) return false;\n              return true;\n            }\n            return !!val;\n          };\n          // If this column has ref table, then render links to ref table item\n          antdCol.render = (...args: any /* value, record, index */) => (\n            <div>\n              {/* @ts-ignore TODO Ignore error: TS2556: A spread argument must either have a tuple type or be passed to a rest parameter. */}\n              {lastRender(...args)}{' '}\n              {hasVal(args[0]) && (\n                <Popover\n                  title='Ref Table Links'\n                  trigger='click'\n                  content={<RefTableLinks value={args[0]} column={column} />}\n                >\n                  <RightSquareFilled />\n                </Popover>\n              )}\n            </div>\n          );\n        }\n\n        return antdCol;\n      });\n\n    // common columns\n    cols.push({\n      key: 'createdAt',\n      title: 'createdAt',\n      dataIndex: 'createdAt',\n      sortOrder: getColumnSortOrder('createdAt', sorter),\n      sorter: true,\n    });\n    cols.push({\n      key: 'updatedAt',\n      title: 'updatedAt',\n      dataIndex: 'updatedAt',\n      sortOrder: getColumnSortOrder('updatedAt', sorter),\n      sorter: true,\n    });\n    cols.push({\n      key: 'actions',\n      dataIndex: primaryKey,\n      title: 'Actions',\n      render: (id: string) => (\n        <div>\n          <Link\n            to={{\n              pathname: `/${dbName}/${tableName}/update`,\n              search: `?${primaryKey}=${id}`,\n            }}\n          >\n            Update\n          </Link>{' '}\n          |{' '}\n          <Link\n            to={{\n              pathname: `/${dbName}/${tableName}/get`,\n              search: `?${primaryKey}=${id}`,\n            }}\n          >\n            Detail\n          </Link>\n        </div>\n      ),\n    });\n    return cols;\n  };\n\n  const renderTable = () => {\n    if (loading) return <Spin tip={loading}>Loading...</Spin>;\n    if (errMsg) return <Alert message={errMsg} type='error' />;\n    if (!rows) return null;\n    // When router changed, before loading next table rows,\n    // contentTableName is old table, but this.props.tableName is new table.\n    if (contentTableName !== tableName) return null;\n    return (\n      <div>\n        {alertValidations()}\n        <Table\n          size='small'\n          showSorterTooltip={false}\n          rowKey={primaryKey}\n          columns={getTableColumns()}\n          dataSource={filteredSortedData()}\n          pagination={{\n            current: page,\n            pageSize,\n            // total: filteredSortedData().length,\n            showQuickJumper: true,\n            showTotal: (total) => `Total ${total} items`,\n          }}\n          onChange={handleTableChange}\n        />\n      </div>\n    );\n  };\n\n  return (\n    <div className='dm-list-page list-component'>\n      <div className='table-filter'>\n        <Row gutter={10}>\n          {filterCols(columns).map((f) => (\n            <Col key={f.id} span={6}>\n              {f.name}\n              :\n              <Input\n                size='small'\n                value={filter[f.id]}\n                onChange={handleFilterChange(f.id)}\n              />\n            </Col>\n          ))}\n        </Row>\n      </div>\n      {renderTable()}\n    </div>\n  );\n};\n\nexport default ListPage;\n\nListPage.propTypes = {\n  // Even tableName is now passing from context,\n  // but we need to pass props.tableName to get new data from backend API\n  tableName: PropTypes.string.isRequired,\n};\n"],"mappings":"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"}