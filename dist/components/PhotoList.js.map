{"version":3,"file":"PhotoList.js","names":["React","PropTypes","List","Button","ImageLink","listGrid","gutter","xs","sm","md","lg","xl","xxl","downloadImage","imgUrl","forceDownload","blob","filename","a","document","createElement","download","href","body","appendChild","click","remove","downloadResource","url","split","pop","fetch","headers","Headers","Origin","window","location","origin","mode","then","response","blobUrl","URL","createObjectURL","catch","e","console","error","renderItem","item","Item","imgSrc","description","onClick","PhotoList","photos","renderDup","photoMap","forEach","photo","undefined","Object","keys","filter","key","map","join","grid","dataSource","propTypes","arrayOf","shape","string","isRequired","defaultProps"],"sources":["../../src/components/PhotoList.tsx"],"sourcesContent":["import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { List, Button } from \"antd\";\n\nimport { ImageLink } from \"./Links\";\n\nconst listGrid = {\n  gutter: 16,\n  xs: 1,\n  sm: 2,\n  md: 4,\n  lg: 4,\n  xl: 4,\n  xxl: 3,\n};\n\nexport type PhotoType = {\n  url: string;\n  imgSrc: string;\n  description: string;\n};\n\n// Copy from https://stackoverflow.com/questions/49474775/chrome-65-blocks-cross-origin-a-download-client-side-workaround-to-force-down\nconst downloadImage = (imgUrl: string) => {\n  function forceDownload(blob: string, filename: string) {\n    var a = document.createElement(\"a\");\n    a.download = filename;\n    a.href = blob;\n    // For Firefox https://stackoverflow.com/a/32226068\n    document.body.appendChild(a);\n    a.click();\n    a.remove();\n  }\n  // Current blob size limit is around 500MB for browsers\n  function downloadResource(url: string, filename: string) {\n    if (!filename) {\n      // Try to get the last part of URL as the filename\n      // for example `353339.jpg` from `https://img.com/a/b/c/353339.jpg`\n      filename = url.split(\"\\\\\").pop()?.split(\"/\").pop() || \"\";\n    }\n    fetch(url, {\n      headers: new Headers({\n        Origin: window.location.origin,\n      }),\n      mode: \"cors\",\n    })\n      .then((response) => response.blob())\n      .then((blob) => {\n        let blobUrl = window.URL.createObjectURL(blob);\n        forceDownload(blobUrl, filename);\n      })\n      .catch((e) => console.error(\"downloadImage() failed to fetch\", e));\n  }\n  downloadResource(imgUrl, \"\");\n};\n\nconst renderItem = (item: PhotoType) => (\n  <List.Item>\n    <ImageLink\n      url={item.url}\n      imgSrc={item.imgSrc}\n      description={item.description}\n    />\n    <Button\n      onClick={() => {\n        downloadImage(item.url);\n      }}\n    >\n      Download\n    </Button>\n  </List.Item>\n);\n\nconst PhotoList = ({ photos }: { photos: PhotoType[] }) => {\n  const renderDup = () => {\n    const photoMap: {\n      [key: string]: number;\n    } = {};\n    photos.forEach((photo) => {\n      if (photoMap[photo.url] === undefined) {\n        photoMap[photo.url] = 0;\n      } else {\n        photoMap[photo.url] += 1;\n      }\n    });\n    return Object.keys(photoMap)\n      .filter((key) => photoMap[key] > 1)\n      .map((key) => photoMap[key])\n      .join(\",\");\n  };\n\n  return (\n    <div>\n      {renderDup()}\n      <List grid={listGrid} dataSource={photos} renderItem={renderItem} />\n    </div>\n  );\n};\n\nPhotoList.propTypes = {\n  photos: PropTypes.arrayOf(\n    PropTypes.shape({\n      url: PropTypes.string.isRequired,\n      imgSrc: PropTypes.string.isRequired,\n      description: PropTypes.string,\n    })\n  ),\n};\n\nPhotoList.defaultProps = { photos: [] };\n\nexport default PhotoList;\n"],"mappings":"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"}