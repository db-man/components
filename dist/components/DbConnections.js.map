{"version":3,"file":"DbConnections.js","names":["React","useRef","Button","GithubDb","constants","reloadDbsSchemaAsync","EditableTable","saveToFile","data","filename","blob","Blob","type","link","document","createElement","href","URL","createObjectURL","download","click","DbConnections","storage","fileInputRef","handleDbConnectionEnable","githubDb","personalAccessToken","get","LS_KEY_GITHUB_PERSONAL_ACCESS_TOKEN","repoPath","LS_KEY_GITHUB_REPO_PATH","owner","LS_KEY_GITHUB_OWNER","repoName","LS_KEY_GITHUB_REPO_NAME","dbsSchema","LS_KEY_DBS_SCHEMA","github","then","handleExport","jsonStrData","JSON","stringify","LS_KEY_DB_CONNECTIONS","handleImport","current","handleFileChange","event","file","target","files","reader","FileReader","onload","e","jsonString","result","parsedData","parse","set","alert","readAsText","className","onEnable","onClick","ref","style","display","onChange"],"sources":["../../src/components/DbConnections.tsx"],"sourcesContent":["import React, { useRef } from 'react';\n\nimport { Button } from 'antd';\nimport { GithubDb } from '@db-man/github';\n\nimport * as constants from '../constants';\nimport reloadDbsSchemaAsync from '../pages/helpers';\nimport EditableTable from './EditableTable';\n\nexport type StorageType = {\n  set: (k: string, v: string) => void;\n  get: (k: string) => string | null;\n};\n\nconst saveToFile = (data: string, filename: string) => {\n  const blob = new Blob([data], { type: 'application/json' });\n  const link = document.createElement('a');\n  link.href = URL.createObjectURL(blob);\n  link.download = filename;\n  link.click();\n};\n\n/**\n * To save online db tables schema in the local db, then pages could load faster\n */\nconst DbConnections = ({ storage }: { storage: StorageType }) => {\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const handleDbConnectionEnable = () => {\n    const githubDb = new GithubDb({\n      personalAccessToken:\n        storage.get(constants.LS_KEY_GITHUB_PERSONAL_ACCESS_TOKEN) || '',\n      repoPath: storage.get(constants.LS_KEY_GITHUB_REPO_PATH) || '',\n      owner: storage.get(constants.LS_KEY_GITHUB_OWNER) || '',\n      repoName: storage.get(constants.LS_KEY_GITHUB_REPO_NAME) || '',\n      dbsSchema: storage.get(constants.LS_KEY_DBS_SCHEMA) || '',\n    });\n    const { github } = githubDb;\n    reloadDbsSchemaAsync(github, githubDb).then(() => {});\n  };\n\n  const handleExport = () => {\n    const jsonStrData = JSON.stringify({\n      [constants.LS_KEY_DBS_SCHEMA]: storage.get(constants.LS_KEY_DBS_SCHEMA),\n      [constants.LS_KEY_DB_CONNECTIONS]: storage.get(\n        constants.LS_KEY_DB_CONNECTIONS\n      ),\n    });\n    saveToFile(jsonStrData, 'DbManExportData.json');\n  };\n\n  const handleImport = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n\n    if (!file) return;\n\n    const reader = new FileReader();\n\n    reader.onload = (e: ProgressEvent<FileReader>) => {\n      const jsonString = e.target?.result as string;\n      const parsedData = JSON.parse(jsonString);\n\n      storage.set(\n        constants.LS_KEY_DBS_SCHEMA,\n        parsedData[constants.LS_KEY_DBS_SCHEMA]\n      );\n      storage.set(\n        constants.LS_KEY_DB_CONNECTIONS,\n        parsedData[constants.LS_KEY_DB_CONNECTIONS]\n      );\n\n      alert('Finish importing, refresh and enable one connection.');\n    };\n\n    reader.readAsText(file);\n  };\n\n  return (\n    <div className='dm-db-connections'>\n      <h2>Database Connections 2</h2>\n      <EditableTable storage={storage} onEnable={handleDbConnectionEnable} />\n      <Button onClick={handleExport}>Export</Button>{' '}\n      <Button onClick={handleImport}>Import</Button>\n      <input\n        ref={fileInputRef}\n        style={{ display: 'none' }}\n        type='file'\n        onChange={handleFileChange}\n      />\n    </div>\n  );\n};\n\nexport default DbConnections;\n"],"mappings":"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"}