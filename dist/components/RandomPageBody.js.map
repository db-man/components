{"version":3,"file":"RandomPageBody.js","names":["React","useContext","useEffect","useState","Link","List","Card","PageContext","ddRender","listGrid","gutter","xs","sm","md","lg","xl","xxl","getAny","arr","Math","floor","random","length","getRandomItems","rows","randomItems","i","push","RandomPageBody","githubDb","dbName","tableName","primaryKey","columns","content","setContent","getDataAsync","contentAndSha","getTableRows","error","console","renderItem","item","column","find","col","id","createElement","args","fn","getRender","val","Item","to","pathname","search","renderList","grid","dataSource","className"],"sources":["../../src/components/RandomPageBody.tsx"],"sourcesContent":["/* eslint-disable react/destructuring-assignment, no-console, max-len */\n\nimport React, { useContext, useEffect, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { List, Card } from 'antd';\n\n// import { contexts as PageContext, ddRender } from '@db-man/components';\nimport PageContext from '../contexts/page';\nimport * as ddRender from '../ddRender/ddRender';\nimport { RowType } from '../types/Data';\n\nconst listGrid = {\n  gutter: 16,\n  xs: 1,\n  sm: 2,\n  md: 4,\n  lg: 4,\n  xl: 4,\n  xxl: 3,\n};\nconst getAny = (arr: RowType[]) => arr[Math.floor(Math.random() * arr.length)];\nconst getRandomItems = (rows: RowType[]) => {\n  const randomItems = [];\n  for (let i = 0; i < 8; i += 1) {\n    randomItems.push(getAny(rows));\n  }\n  return randomItems;\n};\n\nconst RandomPageBody = () => {\n  const { githubDb, dbName, tableName, primaryKey, columns } =\n    useContext(PageContext);\n  const [content, setContent] = useState<RowType[] | null>(null);\n\n  useEffect(() => {\n    getDataAsync();\n  }, []);\n\n  const getDataAsync = async () => {\n    try {\n      const contentAndSha = await githubDb!.getTableRows(dbName, tableName);\n      setContent(contentAndSha.content);\n    } catch (error) {\n      console.error(\n        'Failed to get JSON file in RandomPageBody component, error:',\n        error\n      );\n    }\n  };\n\n  const renderItem = (item: RowType) => {\n    const column = columns.find((col) => col.id === primaryKey);\n    if (!column) return <div>No primary column found</div>;\n    // TODO move `type:randomPage` out of the primary column, it should be in the table level.\n    const args = column['type:randomPage'] || '';\n    const fn = ddRender.getRender(args) || ((val: any) => val);\n    return (\n      <List.Item>\n        <Card>\n          <div>{fn(item[primaryKey], item, 0)}</div>\n          <Link\n            to={{\n              pathname: `/${dbName}/${tableName}/update`,\n              search: `?${primaryKey}=${item[primaryKey]}`,\n            }}\n          >\n            Update\n          </Link>\n        </Card>\n      </List.Item>\n    );\n  };\n\n  const renderList = () => {\n    if (!content) return null;\n\n    return (\n      <List\n        grid={listGrid}\n        dataSource={getRandomItems(content)}\n        renderItem={renderItem}\n      />\n    );\n  };\n\n  return <div className='random-page-body-component'>{renderList()}</div>;\n};\n\nexport default RandomPageBody;\n"],"mappings":"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"}