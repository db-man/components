{"version":3,"file":"RandomPage.js","names":["React","useCallback","useContext","useEffect","useState","Link","List","Card","PageContext","ddRender","defaultPageSize","listGrid","gutter","xs","sm","md","lg","xl","xxl","getAny","arr","Math","floor","random","length","getRandomItems","rows","randomItems","i","push","RandomPage","githubDb","dbName","tableName","primaryKey","columns","content","setContent","idx","setIdx","getDataAsync","contentAndSha","getTableRows","error","console","onKeyDown","event","key","window","addEventListener","removeEventListener","renderItem","item","column","find","col","id","createElement","args","fn","getRender","val","Item","to","pathname","search","renderList","grid","dataSource","className"],"sources":["../../src/components/RandomPage.tsx"],"sourcesContent":["/* eslint-disable react/destructuring-assignment, no-console, max-len */\n\nimport React, { useCallback, useContext, useEffect, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { List, Card } from 'antd';\n\n// import { contexts as PageContext, ddRender } from '@db-man/components';\nimport PageContext from '../contexts/page';\nimport * as ddRender from '../ddRender/ddRender';\nimport { RowType } from '../types/Data';\n\nconst defaultPageSize = 9;\nconst listGrid = {\n  gutter: 16,\n  xs: 1,\n  sm: 2,\n  md: 4,\n  lg: 4,\n  xl: 4,\n  xxl: 3,\n};\nconst getAny = (arr: RowType[]) => arr[Math.floor(Math.random() * arr.length)];\nconst getRandomItems = (rows: RowType[]) => {\n  const randomItems = [];\n  for (let i = 0; i < defaultPageSize; i += 1) {\n    randomItems.push(getAny(rows));\n  }\n  return randomItems;\n};\n\nexport default function RandomPage() {\n  const { githubDb, dbName, tableName, primaryKey, columns } =\n    useContext(PageContext);\n  const [content, setContent] = useState<RowType[] | null>(null);\n  // idx only used to force reload page data\n  const [idx, setIdx] = useState(0);\n\n  const getDataAsync = useCallback(async () => {\n    try {\n      const contentAndSha = await githubDb!.getTableRows(dbName, tableName);\n      setContent(contentAndSha.content);\n    } catch (error) {\n      console.error(\n        'Failed to get JSON file in RandomPage component, error:',\n        error\n      );\n    }\n  }, [githubDb, dbName, tableName]);\n\n  useEffect(() => {\n    getDataAsync();\n  }, [getDataAsync]);\n\n  // Press `r` to reload page data\n  useEffect(() => {\n    const onKeyDown = (event: KeyboardEvent) => {\n      if (event.key === 'r') {\n        // idx only used to force reload page data\n        setIdx(idx + 1);\n      }\n    };\n\n    window.addEventListener('keydown', onKeyDown);\n    return () => window.removeEventListener('keydown', onKeyDown);\n  }, [idx]);\n\n  const renderItem = (item: RowType) => {\n    const column = columns.find((col) => col.id === primaryKey);\n    if (!column) return <div>No primary column found</div>;\n    // TODO move `type:randomPage` out of the primary column, it should be in the table level.\n    const args = column['type:randomPage'] || '';\n    const fn = ddRender.getRender(args) || ((val: any) => val);\n    return (\n      <List.Item>\n        <Card>\n          <div>{fn(item[primaryKey], item, 0)}</div>\n          <Link\n            to={{\n              pathname: `/${dbName}/${tableName}/update`,\n              search: `?${primaryKey}=${item[primaryKey]}`,\n            }}\n          >\n            Update\n          </Link>\n        </Card>\n      </List.Item>\n    );\n  };\n\n  const renderList = () => {\n    if (!content) return null;\n\n    return (\n      <List\n        grid={listGrid}\n        dataSource={getRandomItems(content)}\n        renderItem={renderItem}\n      />\n    );\n  };\n\n  return (\n    <div className='random-page'>\n      <div className='random-page-body-component'>{renderList()}</div>\n    </div>\n  );\n}\n"],"mappings":"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"}