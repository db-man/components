{"version":3,"file":"QueryPage.js","names":["Row","Col","React","useContext","useEffect","JsonView","PageContext","ReactSimpleCodeEditor","defaultCode","QueryPage","dbName","tableName","githubDb","code","setCode","useState","result","setResult","obj","err","content","setContent","getTableRows","then","response","fn","Function","output","JSON","stringify","message","createElement","className","span","height","value","onChange","style","color","parse","collapsed"],"sources":["../../src/components/QueryPage.tsx"],"sourcesContent":["import { Row, Col } from 'antd';\nimport React, { useContext, useEffect } from 'react';\nimport JsonView from '@uiw/react-json-view';\n\nimport PageContext from '../contexts/page';\nimport ReactSimpleCodeEditor from './ReactSimpleCodeEditor';\nimport { RowType } from '../types/Data';\n\nconst defaultCode = 'return rows.slice(0, 10);';\n\nexport default function QueryPage() {\n  const { dbName, tableName, githubDb } = useContext(PageContext);\n  const [code, setCode] = React.useState(defaultCode);\n  const [result, setResult] = React.useState({ obj: '', err: '' });\n  const [content, setContent] = React.useState<RowType>([]);\n\n  useEffect(() => {\n    githubDb?.getTableRows(dbName, tableName).then((response) => {\n      setContent(response.content);\n    });\n  }, []);\n\n  useEffect(() => {\n    try {\n      // eslint-disable-next-line no-new-func\n      const fn = Function('rows', code);\n\n      const output = fn(content);\n      setResult({ obj: JSON.stringify(output), err: '' });\n    } catch (err: any) {\n      // console.log('[ERROR] Failed to eval function!');\n\n      setResult({ obj: '', err: err.message });\n    }\n  }, [content, code]);\n\n  return (\n    <div className='dm-query-page'>\n      <Row>\n        <Col span={16}>\n          Code:\n          <ReactSimpleCodeEditor\n            height='50em'\n            value={code}\n            onChange={setCode}\n          />\n          <br />\n        </Col>\n        <Col span={8}>\n          <div>Error:</div>\n          <div style={{ color: 'red' }}>{result.err}</div>\n          <div>Result:</div>\n          {result.obj && (\n            <JsonView value={JSON.parse(result.obj)} collapsed={1} />\n          )}\n        </Col>\n      </Row>\n    </div>\n  );\n}\n"],"mappings":"AAAA,SAASA,GAAG,EAAEC,GAAG,QAAQ,MAAM;AAC/B,OAAOC,KAAK,IAAIC,UAAU,EAAEC,SAAS,QAAQ,OAAO;AACpD,OAAOC,QAAQ,MAAM,sBAAsB;AAE3C,OAAOC,WAAW,MAAM,kBAAkB;AAC1C,OAAOC,qBAAqB,MAAM,yBAAyB;AAG3D,MAAMC,WAAW,GAAG,2BAA2B;AAE/C,eAAe,SAASC,SAASA,CAAA,EAAG;EAClC,MAAM;IAAEC,MAAM;IAAEC,SAAS;IAAEC;EAAS,CAAC,GAAGT,UAAU,CAACG,WAAW,CAAC;EAC/D,MAAM,CAACO,IAAI,EAAEC,OAAO,CAAC,GAAGZ,KAAK,CAACa,QAAQ,CAACP,WAAW,CAAC;EACnD,MAAM,CAACQ,MAAM,EAAEC,SAAS,CAAC,GAAGf,KAAK,CAACa,QAAQ,CAAC;IAAEG,GAAG,EAAE,EAAE;IAAEC,GAAG,EAAE;EAAG,CAAC,CAAC;EAChE,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGnB,KAAK,CAACa,QAAQ,CAAU,EAAE,CAAC;EAEzDX,SAAS,CAAC,MAAM;IACdQ,QAAQ,EAAEU,YAAY,CAACZ,MAAM,EAAEC,SAAS,CAAC,CAACY,IAAI,CAAEC,QAAQ,IAAK;MAC3DH,UAAU,CAACG,QAAQ,CAACJ,OAAO,CAAC;IAC9B,CAAC,CAAC;EACJ,CAAC,EAAE,EAAE,CAAC;EAENhB,SAAS,CAAC,MAAM;IACd,IAAI;MACF;MACA,MAAMqB,EAAE,GAAGC,QAAQ,CAAC,MAAM,EAAEb,IAAI,CAAC;MAEjC,MAAMc,MAAM,GAAGF,EAAE,CAACL,OAAO,CAAC;MAC1BH,SAAS,CAAC;QAAEC,GAAG,EAAEU,IAAI,CAACC,SAAS,CAACF,MAAM,CAAC;QAAER,GAAG,EAAE;MAAG,CAAC,CAAC;IACrD,CAAC,CAAC,OAAOA,GAAQ,EAAE;MACjB;;MAEAF,SAAS,CAAC;QAAEC,GAAG,EAAE,EAAE;QAAEC,GAAG,EAAEA,GAAG,CAACW;MAAQ,CAAC,CAAC;IAC1C;EACF,CAAC,EAAE,CAACV,OAAO,EAAEP,IAAI,CAAC,CAAC;EAEnB,oBACEX,KAAA,CAAA6B,aAAA;IAAKC,SAAS,EAAC;EAAe,gBAC5B9B,KAAA,CAAA6B,aAAA,CAAC/B,GAAG,qBACFE,KAAA,CAAA6B,aAAA,CAAC9B,GAAG;IAACgC,IAAI,EAAE;EAAG,GAAC,OAEb,eAAA/B,KAAA,CAAA6B,aAAA,CAACxB,qBAAqB;IACpB2B,MAAM,EAAC,MAAM;IACbC,KAAK,EAAEtB,IAAK;IACZuB,QAAQ,EAAEtB;EAAQ,CACnB,CAAC,eACFZ,KAAA,CAAA6B,aAAA,WAAK,CACF,CAAC,eACN7B,KAAA,CAAA6B,aAAA,CAAC9B,GAAG;IAACgC,IAAI,EAAE;EAAE,gBACX/B,KAAA,CAAA6B,aAAA,cAAK,QAAW,CAAC,eACjB7B,KAAA,CAAA6B,aAAA;IAAKM,KAAK,EAAE;MAAEC,KAAK,EAAE;IAAM;EAAE,GAAEtB,MAAM,CAACG,GAAS,CAAC,eAChDjB,KAAA,CAAA6B,aAAA,cAAK,SAAY,CAAC,EACjBf,MAAM,CAACE,GAAG,iBACThB,KAAA,CAAA6B,aAAA,CAAC1B,QAAQ;IAAC8B,KAAK,EAAEP,IAAI,CAACW,KAAK,CAACvB,MAAM,CAACE,GAAG,CAAE;IAACsB,SAAS,EAAE;EAAE,CAAE,CAEvD,CACF,CACF,CAAC;AAEV"}