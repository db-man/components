{"version":3,"file":"utils.js","names":["message","getUrlParams","urlSearchParams","URLSearchParams","window","location","search","Object","fromEntries","entries","getPrimaryKey","columns","foundCol","find","col","primary","id","getTablePrimaryKey","tables","tableName","foundTable","table","name","errMsg","msg","err","console","error","downloadImage","imgUrl","forceDownload","blob","filename","a","document","createElement","download","href","body","appendChild","click","remove","downloadResource","url","split","pop","fetch","headers","Headers","Origin","origin","mode","then","response","blobUrl","URL","createObjectURL","catch","e"],"sources":["../src/utils.ts"],"sourcesContent":["import { types } from '@db-man/github';\nimport { message } from 'antd';\nimport DbColumn from './types/DbColumn';\n\nexport const getUrlParams = () => {\n  const urlSearchParams = new URLSearchParams(window.location.search);\n  return Object.fromEntries(urlSearchParams.entries());\n};\n\n/**\n *\n * @param {*} columns\n * @returns {string}\n */\nexport const getPrimaryKey = (columns: DbColumn[]) => {\n  const foundCol = columns.find((col) => col.primary);\n  return foundCol ? foundCol.id : '';\n};\n\nexport const getTablePrimaryKey = (\n  tables: types.DbTable[],\n  tableName: string\n) => {\n  const foundTable = tables.find((table) => table.name === tableName);\n  if (!foundTable) {\n    return '';\n  }\n\n  return getPrimaryKey(foundTable.columns);\n};\n\nexport const errMsg = (msg: string, err?: Error) => {\n  console.error(`[db-man] ${msg}`, err); // eslint-disable-line no-console\n  message.error(msg);\n};\n\n// Copy from https://stackoverflow.com/questions/49474775/chrome-65-blocks-cross-origin-a-download-client-side-workaround-to-force-down\nexport const downloadImage = (imgUrl: string) => {\n  function forceDownload(blob: string, filename: string) {\n    var a = document.createElement('a');\n    a.download = filename;\n    a.href = blob;\n    // For Firefox https://stackoverflow.com/a/32226068\n    document.body.appendChild(a);\n    a.click();\n    a.remove();\n  }\n  // Current blob size limit is around 500MB for browsers\n  function downloadResource(url: string, filename: string) {\n    if (!filename) {\n      // Try to get the last part of URL as the filename\n      // for example `353339.jpg` from `https://img.com/a/b/c/353339.jpg`\n      filename = url.split('\\\\').pop()?.split('/').pop() || '';\n    }\n    fetch(url, {\n      headers: new Headers({\n        Origin: window.location.origin,\n      }),\n      mode: 'cors',\n    })\n      .then((response) => response.blob())\n      .then((blob) => {\n        let blobUrl = window.URL.createObjectURL(blob);\n        forceDownload(blobUrl, filename);\n      })\n      .catch((e) => console.error('downloadImage() failed to fetch', e));\n  }\n  downloadResource(imgUrl, '');\n};\n"],"mappings":"AACA,SAASA,OAAO,QAAQ,MAAM;AAG9B,OAAO,MAAMC,YAAY,GAAGA,CAAA,KAAM;EAChC,MAAMC,eAAe,GAAG,IAAIC,eAAe,CAACC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC;EACnE,OAAOC,MAAM,CAACC,WAAW,CAACN,eAAe,CAACO,OAAO,CAAC,CAAC,CAAC;AACtD,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMC,aAAa,GAAIC,OAAmB,IAAK;EACpD,MAAMC,QAAQ,GAAGD,OAAO,CAACE,IAAI,CAAEC,GAAG,IAAKA,GAAG,CAACC,OAAO,CAAC;EACnD,OAAOH,QAAQ,GAAGA,QAAQ,CAACI,EAAE,GAAG,EAAE;AACpC,CAAC;AAED,OAAO,MAAMC,kBAAkB,GAAGA,CAChCC,MAAuB,EACvBC,SAAiB,KACd;EACH,MAAMC,UAAU,GAAGF,MAAM,CAACL,IAAI,CAAEQ,KAAK,IAAKA,KAAK,CAACC,IAAI,KAAKH,SAAS,CAAC;EACnE,IAAI,CAACC,UAAU,EAAE;IACf,OAAO,EAAE;EACX;EAEA,OAAOV,aAAa,CAACU,UAAU,CAACT,OAAO,CAAC;AAC1C,CAAC;AAED,OAAO,MAAMY,MAAM,GAAGA,CAACC,GAAW,EAAEC,GAAW,KAAK;EAClDC,OAAO,CAACC,KAAK,CAAE,YAAWH,GAAI,EAAC,EAAEC,GAAG,CAAC,CAAC,CAAC;EACvCzB,OAAO,CAAC2B,KAAK,CAACH,GAAG,CAAC;AACpB,CAAC;;AAED;AACA,OAAO,MAAMI,aAAa,GAAIC,MAAc,IAAK;EAC/C,SAASC,aAAaA,CAACC,IAAY,EAAEC,QAAgB,EAAE;IACrD,IAAIC,CAAC,GAAGC,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC;IACnCF,CAAC,CAACG,QAAQ,GAAGJ,QAAQ;IACrBC,CAAC,CAACI,IAAI,GAAGN,IAAI;IACb;IACAG,QAAQ,CAACI,IAAI,CAACC,WAAW,CAACN,CAAC,CAAC;IAC5BA,CAAC,CAACO,KAAK,CAAC,CAAC;IACTP,CAAC,CAACQ,MAAM,CAAC,CAAC;EACZ;EACA;EACA,SAASC,gBAAgBA,CAACC,GAAW,EAAEX,QAAgB,EAAE;IACvD,IAAI,CAACA,QAAQ,EAAE;MACb;MACA;MACAA,QAAQ,GAAGW,GAAG,CAACC,KAAK,CAAC,IAAI,CAAC,CAACC,GAAG,CAAC,CAAC,EAAED,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC,IAAI,EAAE;IAC1D;IACAC,KAAK,CAACH,GAAG,EAAE;MACTI,OAAO,EAAE,IAAIC,OAAO,CAAC;QACnBC,MAAM,EAAE7C,MAAM,CAACC,QAAQ,CAAC6C;MAC1B,CAAC,CAAC;MACFC,IAAI,EAAE;IACR,CAAC,CAAC,CACCC,IAAI,CAAEC,QAAQ,IAAKA,QAAQ,CAACtB,IAAI,CAAC,CAAC,CAAC,CACnCqB,IAAI,CAAErB,IAAI,IAAK;MACd,IAAIuB,OAAO,GAAGlD,MAAM,CAACmD,GAAG,CAACC,eAAe,CAACzB,IAAI,CAAC;MAC9CD,aAAa,CAACwB,OAAO,EAAEtB,QAAQ,CAAC;IAClC,CAAC,CAAC,CACDyB,KAAK,CAAEC,CAAC,IAAKhC,OAAO,CAACC,KAAK,CAAC,iCAAiC,EAAE+B,CAAC,CAAC,CAAC;EACtE;EACAhB,gBAAgB,CAACb,MAAM,EAAE,EAAE,CAAC;AAC9B,CAAC"}